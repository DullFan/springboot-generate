{"version":3,"file":"useDragSorter.js","sources":["../../../src/tag-input/hooks/useDragSorter.ts"],"sourcesContent":["import { ref, reactive } from 'vue';\nimport { DragSortProps, DragSortInnerProps } from '../interface';\n\nexport default function useDragSorter<T>(props: DragSortProps<T>): DragSortInnerProps {\n  const { sortOnDraggable, onDragSort, onDragOverCheck } = props;\n  const draggingIndex = ref(-1);\n  const dragStartData = ref(null);\n  const isDropped = ref(null);\n  const startInfo = reactive({ nodeX: 0, nodeWidth: 0, mouseX: 0 });\n\n  const onDragOver = (e: DragEvent, index: number, record: T) => {\n    e.preventDefault();\n    if (draggingIndex.value === index || draggingIndex.value === -1) return;\n    const target = e.target as HTMLElement;\n    if (onDragOverCheck?.targetClassNameRegExp && !onDragOverCheck?.targetClassNameRegExp.test(target.className)) {\n      return;\n    }\n\n    if (onDragOverCheck?.x && target) {\n      if (!startInfo.nodeWidth) return;\n\n      const { x, width } = target.getBoundingClientRect();\n      const targetNodeMiddleX = x + width / 2;\n      const draggingNodeLeft = e.clientX - (startInfo.mouseX - startInfo.nodeX);\n      const draggingNodeRight = draggingNodeLeft + startInfo.nodeWidth;\n\n      let overlap = false;\n      if (draggingNodeLeft > x && draggingNodeLeft < x + width) {\n        overlap = draggingNodeLeft < targetNodeMiddleX;\n      } else {\n        overlap = draggingNodeRight > targetNodeMiddleX;\n      }\n\n      if (!overlap) return;\n    }\n\n    onDragSort?.({\n      currentIndex: draggingIndex.value,\n      current: dragStartData,\n      target: record,\n      targetIndex: index,\n    });\n\n    draggingIndex.value = index;\n  };\n\n  if (!sortOnDraggable) {\n    return {};\n  }\n\n  function onDragStart(e: DragEvent, index: number, record: T) {\n    draggingIndex.value = index;\n    dragStartData.value = record;\n    const target = e.target as HTMLElement;\n    if (onDragOverCheck && target) {\n      const { x, width } = target.getBoundingClientRect();\n      startInfo.nodeX = x;\n      startInfo.nodeWidth = width;\n      startInfo.mouseX = e.clientX;\n    }\n  }\n\n  function onDrop() {\n    isDropped.value = true;\n  }\n\n  function onDragEnd() {\n    if (!isDropped.value) {\n      // 取消排序，待扩展 api，输出 dragStartData\n    }\n    isDropped.value = false;\n    draggingIndex.value = -1;\n    dragStartData.value = null;\n  }\n\n  function getDragProps(index: number, record: T) {\n    if (sortOnDraggable) {\n      return {\n        draggable: true,\n        onDragstart: (e: DragEvent) => {\n          onDragStart(e, index, record);\n        },\n        onDragover: (e: DragEvent) => {\n          onDragOver(e, index, record);\n        },\n        onDrop: () => {\n          onDrop();\n        },\n        onDragend: () => {\n          onDragEnd();\n        },\n      };\n    }\n    return {};\n  }\n\n  return { onDragStart, onDragOver, onDrop, onDragEnd, getDragProps, dragging: draggingIndex.value !== -1 };\n}\n"],"names":["useDragSorter","props","sortOnDraggable","onDragSort","onDragOverCheck","draggingIndex","ref","dragStartData","isDropped","startInfo","reactive","nodeX","nodeWidth","mouseX","onDragOver","e","index","record","preventDefault","value","target","targetClassNameRegExp","test","className","x","_target$getBoundingCl","getBoundingClientRect","width","targetNodeMiddleX","draggingNodeLeft","clientX","draggingNodeRight","overlap","currentIndex","current","targetIndex","onDragStart","_target$getBoundingCl2","onDrop","onDragEnd","getDragProps","draggable","onDragstart","onDragover","onDragend","dragging"],"mappings":"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"}