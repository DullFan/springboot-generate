{"version":3,"file":"watermark.js","sources":["../../src/watermark/watermark.tsx"],"sourcesContent":["import { computed, onMounted, defineComponent, watch, ref, reactive } from 'vue';\nimport props from './props';\nimport generateBase64Url from '../_common/js/watermark/generateBase64Url';\nimport randomMovingStyle from '../_common/js/watermark/randomMovingStyle';\nimport injectStyle from '../_common/js/utils/injectStyle';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useMutationObserver } from './hooks';\nimport { useContent } from '../hooks/tnode';\n\nexport default defineComponent({\n  name: 'TWatermark',\n  props,\n  setup(props) {\n    const backgroundImage = ref('');\n    const watermarkRef = ref<HTMLElement>();\n    const watermarkContentRef = ref<HTMLElement>();\n    const parent = ref<HTMLElement>();\n\n    const offset = reactive(props.offset || []);\n\n    const gapX = computed(() => {\n      return props.movable ? 0 : props.x;\n    });\n\n    const gapY = computed(() => {\n      return props.movable ? 0 : props.y;\n    });\n\n    const rotate = computed(() => {\n      return props.movable ? 0 : props.rotate;\n    });\n\n    const backgroundRepeat = computed(() => {\n      if (props.movable) {\n        return 'no-repeat';\n      }\n      return props.isRepeat ? 'repeat' : 'no-repeat';\n    });\n\n    const offsetLeft = computed(() => {\n      return offset[0] || gapX.value / 2;\n    });\n\n    const offsetTop = computed(() => {\n      return offset[1] || gapY.value / 2;\n    });\n\n    const bgImageOptions = computed(() => ({\n      width: props.width,\n      height: props.height,\n      rotate: rotate.value,\n      lineSpace: props.lineSpace,\n      alpha: props.alpha,\n      gapX: gapX.value,\n      gapY: gapY.value,\n      watermarkContent: props.watermarkContent,\n      offsetLeft: offsetLeft.value,\n      offsetTop: offsetTop.value,\n    }));\n\n    const injectWaterMark = () => {\n      generateBase64Url(bgImageOptions.value, (base64Url) => {\n        backgroundImage.value = base64Url;\n      });\n      const keyframesStyle = randomMovingStyle();\n      injectStyle(keyframesStyle);\n    };\n\n    onMounted(() => {\n      injectWaterMark();\n      parent.value = watermarkRef.value.parentElement;\n      useMutationObserver(\n        parent.value,\n        (mutations) => {\n          if (props.removable) return;\n          mutations.forEach((mutation) => {\n            if (mutation.type === 'childList') {\n              const removeNodes = mutation.removedNodes;\n              removeNodes.forEach((node) => {\n                const element = node as HTMLElement;\n                if (element === watermarkRef.value) {\n                  parent.value.appendChild(element);\n                }\n                if (element === watermarkContentRef.value) {\n                  watermarkRef.value.appendChild(element);\n                }\n              });\n            }\n          });\n        },\n        {\n          attributes: true,\n          childList: true,\n          characterData: true,\n          subtree: true,\n        },\n      );\n    });\n\n    watch(() => props.watermarkContent, injectWaterMark, { deep: true });\n\n    return {\n      gapX,\n      gapY,\n      backgroundRepeat,\n      backgroundImage,\n      watermarkRef,\n      watermarkContentRef,\n      bgImageOptions,\n    };\n  },\n\n  render() {\n    const COMPONENT_NAME = usePrefixClass('watermark');\n    const renderContent = useContent();\n\n    return (\n      <div\n        style={{ position: 'relative', overflow: 'hidden', width: '100%' }}\n        class={COMPONENT_NAME.value}\n        ref=\"watermarkRef\"\n      >\n        {renderContent('default', 'content')}\n        <div\n          ref=\"watermarkContentRef\"\n          style={{\n            zIndex: this.zIndex,\n            position: 'absolute',\n            left: 0,\n            right: 0,\n            top: 0,\n            bottom: 0,\n            width: '100%',\n            height: '100%',\n            backgroundSize: `${this.gapX + this.width}px`,\n            pointerEvents: 'none',\n            backgroundRepeat: this.backgroundRepeat,\n            backgroundImage: `url('${this.backgroundImage}')`,\n            animation: this.movable ? `watermark infinite ${(this.moveInterval * 4) / 60}s` : 'none',\n          }}\n        />\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","setup","backgroundImage","ref","watermarkRef","watermarkContentRef","parent","offset","reactive","gapX","computed","movable","x","gapY","y","rotate","backgroundRepeat","isRepeat","offsetLeft","value","offsetTop","bgImageOptions","width","height","lineSpace","alpha","watermarkContent","injectWaterMark","generateBase64Url","base64Url","keyframesStyle","randomMovingStyle","injectStyle","onMounted","parentElement","useMutationObserver","mutations","removable","forEach","mutation","type","removeNodes","removedNodes","node","element","appendChild","attributes","childList","characterData","subtree","watch","deep","render","COMPONENT_NAME","usePrefixClass","renderContent","useContent","_createVNode","position","overflow","zIndex","left","right","top","bottom","backgroundSize","concat","pointerEvents","animation","moveInterval"],"mappings":"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"}