{"version":3,"file":"ImageItem.mjs","sources":["../../../src/image-viewer/base/ImageItem.tsx"],"sourcesContent":["import { computed, defineComponent, PropType, ref, toRefs, watch } from 'vue';\nimport { ImageErrorIcon } from 'tdesign-icons-vue-next';\nimport { usePrefixClass, useConfig } from '../../hooks/useConfig';\nimport { useDrag } from '../hooks';\nimport { useImagePreviewUrl } from '../../hooks/useImagePreviewUrl';\n\nexport default defineComponent({\n  name: 'TImageItem',\n  props: {\n    rotate: Number,\n    scale: Number,\n    mirror: Number,\n    src: [String, Object] as PropType<string | File>,\n    placementSrc: [String, Object] as PropType<string | File>,\n  },\n\n  setup(props) {\n    const { src, placementSrc } = toRefs(props);\n    const classPrefix = usePrefixClass();\n    const error = ref(false);\n    const loaded = ref(false);\n    const { transform, mouseDownHandler } = useDrag({ translateX: 0, translateY: 0 });\n    const { globalConfig } = useConfig('imageViewer');\n    const errorText = globalConfig.value.errorText;\n\n    const imgStyle = computed(() => ({\n      transform: `rotate(${props.rotate}deg) scale(${props.scale})`,\n      display: !props.placementSrc || loaded.value ? 'block' : 'none',\n    }));\n    const placementImgStyle = computed(() => ({\n      transform: `rotate(${props.rotate}deg) scale(${props.scale})`,\n      display: !loaded.value ? 'block' : 'none',\n    }));\n    const boxStyle = computed(() => {\n      const { translateX, translateY } = transform.value;\n      return {\n        transform: `translate(${translateX}px, ${translateY}px) scale(${props.mirror}, 1)`,\n      };\n    });\n\n    const resetStatus = () => {\n      error.value = false;\n      loaded.value = false;\n    };\n\n    const { previewUrl: mainImagePreviewUrl } = useImagePreviewUrl(src);\n    const { previewUrl: placementImagePreviewUrl } = useImagePreviewUrl(placementSrc);\n\n    watch([mainImagePreviewUrl, placementImagePreviewUrl], () => {\n      resetStatus();\n    });\n\n    return () => (\n      <div class={`${classPrefix.value}-image-viewer__modal-pic`}>\n        <div class={`${classPrefix.value}-image-viewer__modal-box`} style={boxStyle.value}>\n          {error.value && (\n            <div class={`${classPrefix.value}-image-viewer__img-error`}>\n              {/* 脱离文档流 */}\n              <div class={`${classPrefix.value}-image-viewer__img-error-content`}>\n                <ImageErrorIcon size=\"4em\" />\n                <div class={`${classPrefix.value}-image-viewer__img-error-text`}>{errorText}</div>\n              </div>\n            </div>\n          )}\n\n          {!error.value && !!props.placementSrc && placementImagePreviewUrl.value && (\n            <img\n              class={`${classPrefix.value}-image-viewer__modal-image`}\n              onMousedown={(event: MouseEvent) => {\n                event.stopPropagation();\n                mouseDownHandler(event);\n              }}\n              src={placementImagePreviewUrl.value}\n              style={placementImgStyle.value}\n              alt=\"image\"\n              draggable=\"false\"\n            />\n          )}\n\n          {!error.value && mainImagePreviewUrl.value && (\n            <img\n              class={`${classPrefix.value}-image-viewer__modal-image`}\n              onMousedown={(event: MouseEvent) => {\n                event.stopPropagation();\n                mouseDownHandler(event);\n              }}\n              src={mainImagePreviewUrl.value}\n              onLoad={() => (loaded.value = true)}\n              onError={() => (error.value = true)}\n              style={imgStyle.value}\n              alt=\"image\"\n              draggable=\"false\"\n            />\n          )}\n        </div>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","rotate","Number","scale","mirror","src","String","Object","placementSrc","setup","_toRefs","toRefs","classPrefix","usePrefixClass","error","ref","loaded","_useDrag","useDrag","translateX","translateY","transform","mouseDownHandler","_useConfig","useConfig","globalConfig","errorText","value","imgStyle","computed","concat","display","placementImgStyle","boxStyle","_transform$value","resetStatus","_useImagePreviewUrl","useImagePreviewUrl","mainImagePreviewUrl","previewUrl","_useImagePreviewUrl2","placementImagePreviewUrl","watch","_createVNode","ImageErrorIcon","onMousedown","event","stopPropagation","onLoad","onError"],"mappings":"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"}