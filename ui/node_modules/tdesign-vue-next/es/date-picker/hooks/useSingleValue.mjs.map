{"version":3,"file":"useSingleValue.mjs","sources":["../../../src/date-picker/hooks/useSingleValue.tsx"],"sourcesContent":["import { toRefs, watchEffect, ref, computed } from 'vue';\nimport {\n  formatDate,\n  formatTime,\n  isValidDate,\n  getDefaultFormat,\n  parseToDayjs,\n} from '../../_common/js/date-picker/format';\nimport useVModel from '../../hooks/useVModel';\nimport { TdDatePickerProps } from '../type';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\n\nexport default function useSingleValue(props: TdDatePickerProps) {\n  const { value: valueFromProps, modelValue } = toRefs(props);\n  const [value, onChange] = useVModel(valueFromProps, modelValue, props.defaultValue, props.onChange);\n\n  const formatRef = computed(() =>\n    getDefaultFormat({\n      mode: props.mode,\n      format: props.format,\n      enableTimePicker: props.enableTimePicker,\n    }),\n  );\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(formatRef.value.format))\n      console.error(`format: ${formatRef.value.format} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n  }\n\n  const time = ref(formatTime(value.value, formatRef.value.format, formatRef.value.timeFormat, props.defaultTime));\n  const month = ref<number>(parseToDayjs(value.value, formatRef.value.format).month());\n  const year = ref<number>(parseToDayjs(value.value, formatRef.value.format).year());\n  const cacheValue = ref(formatDate(value.value, { format: formatRef.value.format })); // 缓存选中值，panel 点击时更改\n\n  // 输入框响应 value 变化\n  watchEffect(() => {\n    if (!value.value) {\n      cacheValue.value = '';\n      return;\n    }\n    if (!isValidDate(value.value, formatRef.value.format)) return;\n\n    cacheValue.value = formatDate(value.value, {\n      format: formatRef.value.format,\n    });\n    time.value = formatTime(value.value, formatRef.value.format, formatRef.value.timeFormat, props.defaultTime);\n  });\n\n  return {\n    year,\n    month,\n    value,\n    time,\n    cacheValue,\n    onChange,\n  };\n}\n"],"names":["useSingleValue","props","_toRefs","toRefs","valueFromProps","value","modelValue","_useVModel","useVModel","defaultValue","onChange","_useVModel2","_slicedToArray","formatRef","computed","getDefaultFormat","mode","format","enableTimePicker","extractTimeFormat","console","error","concat","time","ref","formatTime","timeFormat","defaultTime","month","parseToDayjs","year","cacheValue","formatDate","watchEffect","isValidDate"],"mappings":"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"}