{"version":3,"file":"useHoverKeyboardEvent.js","sources":["../../../src/table/hooks/useHoverKeyboardEvent.ts"],"sourcesContent":["import { toRefs, Ref, ref, computed } from 'vue';\nimport get from 'lodash/get';\nimport { BaseTableProps } from '../interface';\nimport { on, off } from '../../utils/dom';\nimport { ALL_REG, ARROW_DOWN_REG, ARROW_UP_REG, CLEAR_REG, ESCAPE_REG, SPACE_REG } from '../../_common/js/common';\nimport { RowEventContext, TableRowData } from '../type';\n\n/**\n * 需要进行表格行操作时，则需要键盘操作的悬浮效果来表达当前的哪一行\n * 如：高亮多行、行选中、行展开等功能\n */\nexport function useHoverKeyboardEvent(props: BaseTableProps, tableRef: Ref<HTMLDivElement>) {\n  const { hover, data, activeRowType, keyboardRowHover, disableSpaceInactiveRow } = toRefs(props);\n  const hoverRow = ref<string | number>();\n  const currentHoverRowIndex = ref(-1);\n\n  // 单行高亮场景，不需要键盘悬浮效果\n  const needKeyboardRowHover = computed(() => {\n    if (activeRowType.value === 'single') return false;\n    if (activeRowType.value === 'multiple') return true;\n    return hover.value || keyboardRowHover.value;\n  });\n\n  const onHoverRow = (ctx: RowEventContext<TableRowData>, extra?: { action?: 'hover' }) => {\n    const rowValue = get(ctx.row, props.rowKey);\n    if (hoverRow.value === rowValue && extra?.action !== 'hover') {\n      if (!disableSpaceInactiveRow.value) {\n        hoverRow.value = undefined;\n      }\n    } else {\n      hoverRow.value = rowValue;\n    }\n    currentHoverRowIndex.value = ctx.index;\n  };\n\n  const clearHoverRow = () => {\n    hoverRow.value = undefined;\n    currentHoverRowIndex.value = -1;\n  };\n\n  const keyboardDownListener = (e: KeyboardEvent) => {\n    if (!needKeyboardRowHover.value) return;\n    const code = e.code || e.key?.trim();\n    if (ARROW_DOWN_REG.test(code)) {\n      e.preventDefault();\n      const index = Math.min(data.value.length - 1, currentHoverRowIndex.value + 1);\n      onHoverRow({ row: data.value[index], index, e }, { action: 'hover' });\n    } else if (ARROW_UP_REG.test(code)) {\n      e.preventDefault();\n      const index = Math.max(0, currentHoverRowIndex.value - 1);\n      onHoverRow({ row: data.value[index], index, e }, { action: 'hover' });\n    } else if (SPACE_REG.test(code) && props.activeRowType !== 'multiple') {\n      const index = currentHoverRowIndex.value;\n      onHoverRow({ row: data.value[index], index, e });\n\n      if (!props.activeRowType) {\n        props.onActiveRowAction?.({\n          action: 'space-one-selection',\n          activeRowList: [{ row: data.value[index], rowIndex: index }],\n        });\n      }\n    } else if (ESCAPE_REG.test(code) && !props.activeRowType) {\n      hoverRow.value = undefined;\n      props.onActiveRowAction?.({ action: 'clear', activeRowList: [] });\n    } else if (ALL_REG.test(code) && !props.activeRowType) {\n      props.onActiveRowAction?.({ action: 'select-all', activeRowList: [] });\n    } else if (CLEAR_REG.test(code) && !props.activeRowType) {\n      props.onActiveRowAction?.({ action: 'clear', activeRowList: [] });\n    }\n  };\n\n  const addRowHoverKeyboardListener = () => {\n    on(tableRef.value, 'keydown', keyboardDownListener);\n  };\n\n  const removeRowHoverKeyboardListener = () => {\n    off(tableRef.value, 'keydown', keyboardDownListener);\n  };\n\n  return {\n    hoverRow,\n    needKeyboardRowHover,\n    clearHoverRow,\n    addRowHoverKeyboardListener,\n    removeRowHoverKeyboardListener,\n  };\n}\n\nexport default useHoverKeyboardEvent;\n"],"names":["useHoverKeyboardEvent","props","tableRef","_toRefs","toRefs","hover","data","activeRowType","keyboardRowHover","disableSpaceInactiveRow","hoverRow","ref","currentHoverRowIndex","needKeyboardRowHover","computed","value","onHoverRow","ctx","extra","rowValue","get","row","rowKey","action","index","clearHoverRow","keyboardDownListener","e","_e$key","code","key","trim","ARROW_DOWN_REG","test","preventDefault","Math","min","length","ARROW_UP_REG","max","SPACE_REG","_props$onActiveRowAct","onActiveRowAction","call","activeRowList","rowIndex","ESCAPE_REG","_props$onActiveRowAct2","ALL_REG","_props$onActiveRowAct3","CLEAR_REG","_props$onActiveRowAct4","addRowHoverKeyboardListener","on","removeRowHoverKeyboardListener","off"],"mappings":"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"}