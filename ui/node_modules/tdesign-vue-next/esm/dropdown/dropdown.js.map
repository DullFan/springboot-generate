{"version":3,"file":"dropdown.js","sources":["../../src/dropdown/dropdown.tsx"],"sourcesContent":["import { defineComponent, ref, computed } from 'vue';\nimport omit from 'lodash/omit';\nimport isArray from 'lodash/isArray';\nimport Popup, { PopupVisibleChangeContext } from '../popup/index';\nimport DropdownMenu from './dropdown-menu';\nimport { DropdownOption, TdDropdownProps } from './type';\nimport props from './props';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport useDropdownOptions from './hooks/useDropdownOptions';\nimport isNumber from 'lodash/isNumber';\n\nexport default defineComponent({\n  name: 'TDropdown',\n  props,\n  setup(props: TdDropdownProps, { attrs }) {\n    const renderTNodeJSX = useTNodeJSX();\n    const COMPONENT_NAME = usePrefixClass('dropdown');\n    const popupElem = ref(null);\n    const isPopupVisible = ref(false);\n\n    const manualCloseTimeout = computed(() => {\n      const delay = props.popupProps?.delay;\n      if (isNumber(delay)) return delay + 10;\n      if (isArray(delay)) return delay[1] + 10 ?? delay[0] + 10;\n      return 160;\n    });\n\n    const handleMenuClick = (data: DropdownOption, context: { e: MouseEvent }) => {\n      if (props.hideAfterItemClick) {\n        setTimeout(() => (isPopupVisible.value = false), manualCloseTimeout.value);\n        props.popupProps?.onVisibleChange?.(false, context);\n        props.popupProps?.['on-visible-change']?.(false, context);\n      }\n\n      props?.onClick?.(data, context);\n    };\n\n    const handleVisibleChange = (visible: boolean, context: PopupVisibleChangeContext) => {\n      isPopupVisible.value = visible;\n\n      props.popupProps?.onVisibleChange?.(visible, context);\n      props.popupProps?.['on-visible-change']?.(visible, context);\n    };\n\n    return () => {\n      const trigger = renderTNodeJSX('default')?.[0];\n      const options = useDropdownOptions(props);\n\n      const popupParams = {\n        ...attrs,\n        disabled: props.disabled,\n        placement: props.placement,\n        trigger: props.trigger,\n        ...omit(props.popupProps, ['onVisibleChange', 'on-visible-change']),\n        overlayInnerClassName: [\n          COMPONENT_NAME.value,\n          (props.popupProps as TdDropdownProps['popupProps'])?.overlayInnerClassName,\n        ],\n      };\n\n      return (\n        <Popup\n          destroyOnClose={true}\n          ref={popupElem}\n          visible={isPopupVisible.value}\n          onVisibleChange={handleVisibleChange}\n          expandAnimation\n          {...popupParams}\n          v-slots={{\n            content: () => (\n              <DropdownMenu {...omit(props, 'onClick')} options={options.value} onClick={handleMenuClick} />\n            ),\n          }}\n        >\n          {trigger}\n        </Popup>\n      );\n    };\n  },\n});\n"],"names":["defineComponent","name","props","setup","attrs","_ref","renderTNodeJSX","useTNodeJSX","COMPONENT_NAME","usePrefixClass","popupElem","ref","isPopupVisible","manualCloseTimeout","computed","_props2$popupProps","delay","popupProps","isNumber","isArray","handleMenuClick","data","context","_props2$onClick","hideAfterItemClick","_props2$popupProps2","_props2$popupProps2$o","_props2$popupProps3","_props2$popupProps3$o","setTimeout","value","onVisibleChange","onClick","handleVisibleChange","visible","_props2$popupProps4","_props2$popupProps4$o","_props2$popupProps5","_props2$popupProps5$o","_renderTNodeJSX","_props2$popupProps6","trigger","options","useDropdownOptions","popupParams","_objectSpread","disabled","placement","omit","overlayInnerClassName","_createVNode","Popup","_mergeProps","content","DropdownMenu"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYA,gBAAeA,eAAgB,CAAA;AAC7BC,EAAAA,IAAM,EAAA,WAAA;AACNC,EAAAA,KAAA,EAAAA,KAAA;AACAC,EAAAA,KAAMD,EAAAA,SAAAA,KAAAA,CAAAA,MAAAA,EAAAA,IAAAA,EAAmC;AAAA,IAAA,IAATE,KAAA,GAAAC,IAAA,CAAAD,KAAA,CAAA;AAC9B,IAAA,IAAME,iBAAiBC,WAAY,EAAA,CAAA;AAC7B,IAAA,IAAAC,cAAA,GAAiBC,eAAe,UAAU,CAAA,CAAA;AAC1C,IAAA,IAAAC,SAAA,GAAYC,IAAI,IAAI,CAAA,CAAA;AACpB,IAAA,IAAAC,cAAA,GAAiBD,IAAI,KAAK,CAAA,CAAA;AAE1B,IAAA,IAAAE,kBAAA,GAAqBC,SAAS,YAAM;AAAA,MAAA,IAAAC,kBAAA,CAAA;AAClC,MAAA,IAAAC,KAAA,GAAA,CAAAD,kBAAA,GAAQb,OAAMe,UAAY,MAAA,IAAA,IAAAF,kBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAlBb,kBAAAA,CAAkBc,KAAA,CAAA;MAChC,IAAIE,SAASF,KAAK,CAAA,EAAG,OAAOA,KAAQ,GAAA,EAAA,CAAA;MACpC,IAAIG,QAAQH,KAAK,CAAA,EAAG,OAAOA,MAAM,CAAK,CAAA,GAAA,EAAA,CAAA;AAC/B,MAAA,OAAA,GAAA,CAAA;AACT,KAAC,CAAA,CAAA;IAEK,IAAAI,eAAA,GAAkB,SAAlBA,eAAAA,CAAmBC,IAAA,EAAsBC,OAA+B,EAAA;AAAA,MAAA,IAAAC,eAAA,CAAA;MAC5E,IAAIrB,OAAMsB,kBAAoB,EAAA;AAAA,QAAA,IAAAC,mBAAA,EAAAC,qBAAA,EAAAC,mBAAA,EAAAC,qBAAA,CAAA;AAC5BC,QAAAA,UAAA,CAAW,YAAA;AAAA,UAAA,OAAOjB,cAAA,CAAekB,KAAQ,GAAA,KAAA,CAAA;SAAQjB,EAAAA,mBAAmBiB,KAAK,CAAA,CAAA;QACzE5B,CAAAA,mBAAAA,GAAAA,MAAM,CAAAe,UAAA,cAAAQ,mBAAA,KAAA,KAAA,CAAA,IAAA,CAAAC,qBAAA,GAANxB,mBAAAA,CAAkB6B,eAAkB,MAAAL,IAAAA,IAAAA,qBAAA,KAApCxB,KAAAA,CAAAA,IAAAA,qBAAAA,CAAAA,IAAAA,CAAAA,mBAAAA,EAAoC,KAAA,EAAOoB,OAAO,CAAA,CAAA;QAClDpB,CAAAA,mBAAAA,GAAAA,MAAM,CAAAe,UAAA,MAAAU,IAAAA,IAAAA,mBAAA,KAAAC,KAAAA,CAAAA,IAAAA,CAAAA,qBAAA,GAAN1B,mBAAAA,CAAmB,mBAAuB,CAAA,MAAA0B,IAAAA,IAAAA,qBAAA,KAA1C1B,KAAAA,CAAAA,IAAAA,qBAAAA,CAAAA,IAAAA,CAAAA,mBAAAA,EAA0C,KAAA,EAAOoB,OAAO,CAAA,CAAA;AAC1D,OAAA;MAEApB,MAAAA,KAAAA,IAAAA,IAAAA,MAAAA,KAAAA,KAAAA,CAAAA,IAAAA,CAAAA,eAAAA,GAAAA,MAAAA,CAAO8B,OAAU,MAAAT,IAAAA,IAAAA,eAAA,eAAjBrB,eAAAA,CAAAA,IAAAA,CAAAA,MAAAA,EAAiBmB,IAAA,EAAMC,OAAO,CAAA,CAAA;KAChC,CAAA;IAEM,IAAAW,mBAAA,GAAsB,SAAtBA,mBAAAA,CAAuBC,OAAA,EAAkBZ,OAAuC,EAAA;AAAA,MAAA,IAAAa,mBAAA,EAAAC,qBAAA,EAAAC,mBAAA,EAAAC,qBAAA,CAAA;MACpF1B,cAAA,CAAekB,KAAQ,GAAAI,OAAA,CAAA;MAEvBhC,CAAAA,mBAAAA,GAAAA,MAAM,CAAAe,UAAA,cAAAkB,mBAAA,KAAA,KAAA,CAAA,IAAA,CAAAC,qBAAA,GAANlC,mBAAAA,CAAkB6B,eAAkB,MAAAK,IAAAA,IAAAA,qBAAA,KAApClC,KAAAA,CAAAA,IAAAA,qBAAAA,CAAAA,IAAAA,CAAAA,mBAAAA,EAAoCgC,OAAA,EAASZ,OAAO,CAAA,CAAA;MACpDpB,CAAAA,mBAAAA,GAAAA,MAAM,CAAAe,UAAA,MAAAoB,IAAAA,IAAAA,mBAAA,KAAAC,KAAAA,CAAAA,IAAAA,CAAAA,qBAAA,GAANpC,mBAAAA,CAAmB,mBAAuB,CAAA,MAAAoC,IAAAA,IAAAA,qBAAA,KAA1CpC,KAAAA,CAAAA,IAAAA,qBAAAA,CAAAA,IAAAA,CAAAA,mBAAAA,EAA0CgC,OAAA,EAASZ,OAAO,CAAA,CAAA;KAC5D,CAAA;AAEA,IAAA,OAAO,YAAM;MAAA,IAAAiB,eAAA,EAAAC,mBAAA,CAAA;AACL,MAAA,IAAAC,OAAA,GAAA,CAAAF,eAAA,GAAUjC,cAAe,CAAA,SAAS,CAAI,MAAA,IAAA,IAAAiC,eAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAA5BA,eAAA,CAA4B,CAAA,CAAA,CAAA;AACtC,MAAA,IAAAG,OAAA,GAAUC,mBAAmBzC,MAAK,CAAA,CAAA;MAExC,IAAM0C,WAAc,GAAAC,aAAA,CAAAA,aAAA,CAAAA,aAAA,KACfzC,KAAA,CAAA,EAAA,EAAA,EAAA;QACH0C,UAAU5C,MAAM,CAAA4C,QAAA;QAChBC,WAAW7C,MAAM,CAAA6C,SAAA;QACjBN,SAASvC,MAAM,CAAAuC,OAAAA;OACZO,EAAAA,IAAK9C,CAAAA,MAAAA,CAAMe,YAAY,CAAC,iBAAA,EAAmB,mBAAmB,CAAC,CAAA,CAAA,EAAA,EAAA,EAAA;AAClEgC,QAAAA,qBAAuB,EAAA,CACrBzC,cAAe,CAAAsB,KAAA,GAAAU,mBAAA,GACdtC,OAAMe,UAA8C,MAAAuB,IAAAA,IAAAA,mBAAA,KAApDtC,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,mBAAAA,CAAoD+C,qBAAA,CAAA;OAEzD,CAAA,CAAA;AAEA,MAAA,OAAAC,WAAA,CAAAC,KAAA,EAAAC,UAAA,CAAA;AAAA,QAAA,gBAAA,EAEoB,IAAA;AAAA,QAAA,KAAA,EACX1C,SAAA;QAAA,SACIE,EAAAA,cAAA,CAAekB,KACxB;AAAA,QAAA,iBAAA,EAAiBG,mBACjB;AAAA,QAAA,iBAAA,EAAA,IAAA;AAAA,OAAA,EACIW;;kBAOHH;;QALCY,OAAS,EAAA,SAAAA,OAAA,GAAA;UAAA,OAAAH,WAAA,CAAAI,aAAA,EAAAF,UAAA,CACWJ,IAAK9C,CAAAA,MAAAA,EAAO,SAAS,CAAA,EAAA;YAAA,SAAYwC,EAAAA,OAAA,CAAQZ,KAAO;YAAA,SAASV,EAAAA,eAAAA;AAAiB,WAAA,CAAA,EAAA,IAAA,CAAA,CAAA;AAAA,SAAA;AAAA,OAAA,CAAA,CAAA;KAOtG,CAAA;AACF,GAAA;AACF,CAAC,CAAA;;;;"}