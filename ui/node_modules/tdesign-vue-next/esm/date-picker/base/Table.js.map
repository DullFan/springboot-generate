{"version":3,"file":"Table.js","sources":["../../../src/date-picker/base/Table.tsx"],"sourcesContent":["import { defineComponent, PropType, computed } from 'vue';\nimport TDatePickerCell from './Cell';\nimport { useConfig, usePrefixClass } from '../../hooks/useConfig';\nimport type { TdDatePickerProps } from '../type';\nimport { parseToDayjs } from '../../_common/js/date-picker/format';\nimport isArray from 'lodash/isArray';\n\nexport default defineComponent({\n  name: 'TDatePickerTable',\n  props: {\n    mode: {\n      type: String as PropType<TdDatePickerProps['mode']>,\n      default: 'date',\n    },\n    value: [String, Number, Array, Date],\n    format: String,\n    firstDayOfWeek: Number,\n    data: Array,\n    time: String,\n    onCellClick: Function,\n    onCellMouseEnter: Function,\n    onCellMouseLeave: Function,\n  },\n  setup(props) {\n    const COMPONENT_NAME = usePrefixClass('date-picker__table');\n    const { globalConfig } = useConfig('datePicker');\n    const { dayjsLocale } = globalConfig.value;\n\n    const weekArr = computed(() => {\n      const weekArr = [];\n      let wi = props.firstDayOfWeek - 1;\n      const len = globalConfig.value.weekdays.length;\n      while (weekArr.length < len) {\n        weekArr.push(globalConfig.value.weekdays[wi]);\n        wi = (wi + len + 1) % len;\n      }\n\n      if (props.mode === 'week') weekArr.unshift(globalConfig.value.weekAbbreviation);\n\n      return weekArr;\n    });\n\n    const showThead = computed(() => props.mode === 'date' || props.mode === 'week');\n\n    // 高亮周区间\n    const weekRowClass = (value: any, format: string, targetValue: Date) => {\n      if (props.mode !== 'week' || !value) return {};\n\n      if (isArray(value)) {\n        if (!value.length) return {};\n        const [startObj, endObj] = value.map((v) => v && parseToDayjs(v, format));\n        const startYear = startObj && startObj.year();\n        const startWeek = startObj?.locale?.(dayjsLocale)?.week?.();\n        const endYear = endObj && endObj.year();\n        const endWeek = endObj?.locale?.(dayjsLocale)?.week?.();\n\n        const targetObj = parseToDayjs(targetValue, format);\n        const targetYear = targetObj.year();\n        const targetWeek = targetObj.week();\n        const isActive =\n          (targetYear === startYear && targetWeek === startWeek) || (targetYear === endYear && targetWeek === endWeek);\n        const isRange =\n          targetYear >= startYear && targetYear <= endYear && targetWeek > startWeek && targetWeek < endWeek;\n        return {\n          // 同年同周\n          [`${COMPONENT_NAME.value}-${props.mode}-row--active`]: isActive,\n          [`${COMPONENT_NAME.value}-${props.mode}-row--range`]: isRange,\n        };\n      }\n\n      return {\n        [`${COMPONENT_NAME.value}-${props.mode}-row--active`]:\n          parseToDayjs(value, format).locale(dayjsLocale).week() ===\n          parseToDayjs(targetValue, format).locale(dayjsLocale).week(),\n      };\n    };\n\n    return () => (\n      <div class={COMPONENT_NAME.value} onMouseleave={(e: MouseEvent) => props.onCellMouseLeave?.({ e })}>\n        <table>\n          {showThead.value && (\n            <thead>\n              <tr>\n                {weekArr.value.map((value: string, i: number) => (\n                  <th key={i}>{value}</th>\n                ))}\n              </tr>\n            </thead>\n          )}\n          <tbody>\n            {props.data.map((row: Array<any>, i: number) => (\n              <tr\n                key={i}\n                class={{\n                  [`${COMPONENT_NAME.value}-${props.mode}-row`]: true,\n                  ...weekRowClass(props.value, props.format, row[0].value),\n                }}\n              >\n                {row.map((col: any, j: number) => (\n                  <TDatePickerCell\n                    {...col}\n                    key={j}\n                    time={props.time}\n                    onClick={props.onCellClick}\n                    onMouseEnter={props.onCellMouseEnter}\n                  />\n                ))}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","mode","type","String","value","Number","Array","Date","format","firstDayOfWeek","data","time","onCellClick","Function","onCellMouseEnter","onCellMouseLeave","setup","COMPONENT_NAME","usePrefixClass","_useConfig","useConfig","globalConfig","dayjsLocale","weekArr","computed","wi","len","weekdays","length","push","unshift","weekAbbreviation","showThead","weekRowClass","targetValue","isArray","_startObj$locale","_startObj$locale$week","_endObj$locale","_endObj$locale$week","_value$map","map","v","parseToDayjs","_value$map2","_slicedToArray","startObj","endObj","startYear","year","startWeek","locale","call","week","endYear","endWeek","targetObj","targetYear","targetWeek","isActive","isRange","_defineProperty","concat","_createVNode","onMouseleave","e","_props$onCellMouseLea","i","row","_objectSpread","col","j"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOA,iBAAeA,eAAgB,CAAA;AAC7BC,EAAAA,IAAM,EAAA,kBAAA;AACNC,EAAAA,KAAO,EAAA;AACLC,IAAAA,IAAM,EAAA;AACJC,MAAAA,IAAM,EAAAC,MAAA;MACN,SAAS,EAAA,MAAA;KACX;IACAC,KAAO,EAAA,CAACD,MAAQ,EAAAE,MAAA,EAAQC,OAAOC,IAAI,CAAA;AACnCC,IAAAA,MAAQ,EAAAL,MAAA;AACRM,IAAAA,cAAgB,EAAAJ,MAAA;AAChBK,IAAAA,IAAM,EAAAJ,KAAA;AACNK,IAAAA,IAAM,EAAAR,MAAA;AACNS,IAAAA,WAAa,EAAAC,QAAA;AACbC,IAAAA,gBAAkB,EAAAD,QAAA;AAClBE,IAAAA,gBAAkB,EAAAF,QAAAA;GACpB;EACAG,qBAAMhB,CAAAA,KAAO,EAAA;AACL,IAAA,IAAAiB,cAAA,GAAiBC,eAAe,oBAAoB,CAAA,CAAA;AAC1D,IAAA,IAAAC,UAAA,GAAyBC,SAAA,CAAU,YAAY,CAAA;MAAvCC,YAAA,GAAAF,UAAA,CAAAE,YAAA,CAAA;AACF,IAAA,IAAEC,WAAY,GAAID,YAAa,CAAAjB,KAAA,CAA7BkB,WAAY,CAAA;AAEd,IAAA,IAAAC,OAAA,GAAUC,SAAS,YAAM;MAC7B,IAAMD,WAAU,EAAC,CAAA;AACb,MAAA,IAAAE,EAAA,GAAKzB,MAAMS,cAAiB,GAAA,CAAA,CAAA;MAC1B,IAAAiB,GAAA,GAAML,YAAa,CAAAjB,KAAA,CAAMuB,QAAS,CAAAC,MAAA,CAAA;AACjCL,MAAAA,OAAAA,QAAAA,CAAQK,SAASF,GAAK,EAAA;QAC3BH,QAAQ,CAAAM,IAAA,CAAKR,YAAa,CAAAjB,KAAA,CAAMuB,SAASF,EAAG,CAAA,CAAA,CAAA;QACtCA,EAAA,GAAA,CAAAA,EAAA,GAAKC,MAAM,CAAK,IAAAA,GAAA,CAAA;AACxB,OAAA;AAEA,MAAA,IAAI1B,MAAMC,IAAS,KAAA,MAAA,EAAQsB,QAAQ,CAAAO,OAAA,CAAQT,YAAa,CAAAjB,KAAA,CAAM2B,gBAAgB,CAAA,CAAA;AAEvER,MAAAA,OAAAA,QAAAA,CAAAA;AACT,KAAC,CAAA,CAAA;IAEK,IAAAS,SAAA,GAAYR,SAAS,YAAA;MAAA,OAAMxB,KAAA,CAAMC,SAAS,MAAU,IAAAD,KAAA,CAAMC,SAAS,MAAM,CAAA;KAAA,CAAA,CAAA;IAG/E,IAAMgC,YAAe,GAAA,SAAfA,YAAeA,CAAC7B,KAAY,EAAAI,MAAA,EAAgB0B,WAAsB,EAAA;MAClE,IAAAlC,KAAA,CAAMC,IAAS,KAAA,MAAA,IAAU,CAACG,KAAA,EAAO,OAAO,EAAC,CAAA;AAEzC,MAAA,IAAA+B,OAAA,CAAQ/B,KAAK,CAAG,EAAA;AAAA,QAAA,IAAAgC,gBAAA,EAAAC,qBAAA,EAAAC,cAAA,EAAAC,mBAAA,CAAA;AAClB,QAAA,IAAI,CAACnC,KAAM,CAAAwB,MAAA,EAAQ,OAAO,EAAC,CAAA;AAC3B,QAAA,IAAAY,UAAA,GAA2BpC,KAAM,CAAAqC,GAAA,CAAI,UAACC,CAAA,EAAA;AAAA,YAAA,OAAMA,CAAK,IAAAC,YAAA,CAAaD,CAAG,EAAAlC,MAAM,CAAC,CAAA;WAAA,CAAA;UAAAoC,WAAA,GAAAC,cAAA,CAAAL,UAAA,EAAA,CAAA,CAAA;AAAjEM,UAAAA,QAAA,GAAAF,WAAA,CAAA,CAAA,CAAA;AAAUG,UAAAA,MAAM,GAAAH,WAAA,CAAA,CAAA,CAAA,CAAA;QACjB,IAAAI,SAAA,GAAYF,QAAY,IAAAA,QAAA,CAASG,IAAK,EAAA,CAAA;AAC5C,QAAA,IAAMC,SAAY,GAAAJ,QAAA,aAAAA,QAAA,KAAA,KAAA,CAAA,IAAA,CAAAV,gBAAA,GAAAU,QAAA,CAAUK,MAAS,cAAAf,gBAAA,KAAA,KAAA,CAAA,IAAA,CAAAA,gBAAA,GAAnBA,gBAAA,CAAAgB,IAAA,CAAAN,QAAA,EAAmBxB,WAAW,uEAA9Bc,gBAAA,CAAiCiB,IAAO,MAAA,IAAA,IAAAhB,qBAAA,KAAxCA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,qBAAA,CAAAe,IAAA,CAAAhB,gBAAwC,CAAA,CAAA;QACpD,IAAAkB,OAAA,GAAUP,MAAU,IAAAA,MAAA,CAAOE,IAAK,EAAA,CAAA;AACtC,QAAA,IAAMM,OAAU,GAAAR,MAAA,aAAAA,MAAA,KAAA,KAAA,CAAA,IAAA,CAAAT,cAAA,GAAAS,MAAA,CAAQI,MAAS,cAAAb,cAAA,KAAA,KAAA,CAAA,IAAA,CAAAA,cAAA,GAAjBA,cAAA,CAAAc,IAAA,CAAAL,MAAA,EAAiBzB,WAAW,mEAA5BgB,cAAA,CAA+Be,IAAO,MAAA,IAAA,IAAAd,mBAAA,KAAtCA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,mBAAA,CAAAa,IAAA,CAAAd,cAAsC,CAAA,CAAA;AAEhD,QAAA,IAAAkB,SAAA,GAAYb,YAAa,CAAAT,WAAA,EAAa1B,MAAM,CAAA,CAAA;AAC5C,QAAA,IAAAiD,UAAA,GAAaD,UAAUP,IAAK,EAAA,CAAA;AAC5B,QAAA,IAAAS,UAAA,GAAaF,UAAUH,IAAK,EAAA,CAAA;AAClC,QAAA,IAAMM,WACHF,UAAe,KAAAT,SAAA,IAAaU,eAAeR,SAAe,IAAAO,UAAA,KAAeH,WAAWI,UAAe,KAAAH,OAAA,CAAA;AACtG,QAAA,IAAMK,UACJH,UAAc,IAAAT,SAAA,IAAaS,cAAcH,OAAW,IAAAI,UAAA,GAAaR,aAAaQ,UAAa,GAAAH,OAAA,CAAA;AACtF,QAAA,OAAAM,eAAA,CAAAA,eAAA,CAAA,EAAA,EAAA,EAAA,CAAAC,MAAA,CAED7C,cAAe,CAAAb,KAAA,EAAA,GAAA,CAAA,CAAA0D,MAAA,CAAS9D,MAAMC,IAAqB,EAAA0D,cAAAA,CAAAA,EAAAA,QAAA,CAAAG,EAAAA,EAAAA,CAAAA,MAAA,CACnD7C,cAAe,CAAAb,KAAA,EAAA0D,GAAAA,CAAAA,CAAAA,MAAA,CAAS9D,MAAMC,IAAoB,kBAAA2D,OAAA,CAAA,CAAA;AAE1D,OAAA;MAEO,OAAAC,eAAA,QAAAC,MAAA,CACD7C,cAAe,CAAAb,KAAA,OAAA0D,MAAA,CAAS9D,MAAMC,IAChC,mBAAA0C,YAAA,CAAavC,KAAO,EAAAI,MAAM,CAAE,CAAA2C,MAAA,CAAO7B,WAAW,CAAE,CAAA+B,IAAA,OAChDV,YAAa,CAAAT,WAAA,EAAa1B,MAAM,CAAE,CAAA2C,MAAA,CAAO7B,WAAW,CAAA,CAAE+B,IAAK,EAAA,CAAA,CAAA;KAEjE,CAAA;IAEA,OAAO,YAAA;AAAA,MAAA,OAAAU,WAAA,CAAA,KAAA,EAAA;QAAA,OACO9C,EAAAA,eAAeb,KAAO;QAAA,cAAc,EAAA,SAAA4D,aAACC,CAAA,EAAA;AAAA,UAAA,IAAAC,qBAAA,CAAA;AAAA,UAAA,OAAA,CAAAA,qBAAA,GAAkBlE,MAAMe,gBAAmB,MAAA,IAAA,IAAAmD,qBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAzBA,qBAAA,CAAAd,IAAA,CAAApD,OAAyB;AAAEiE,YAAAA,CAAE,EAAFA,CAAAA;AAAE,WAAC;;sBAE5FjC,OAAAA,EAAAA,IAAAA,EAAAA,CAAAA,SAAA,CAAU5B,8DAGJmB,OAAA,CAAQnB,KAAM,CAAAqC,GAAA,CAAI,UAACrC,KAAA,EAAe+D;;eACxBA,EAAAA,CAAAA;AAAI,SAAA,EAAA,CAAA/D,KAAA,CAAA,CAAA,CAAA;AAAA,OACd,CAAA,CAAA,CAAA,CAAA,CAJJ,EAAA2D,WAAA,iBASA/D,KAAM,CAAAU,IAAA,CAAK+B,GAAI,CAAA,UAAC2B,GAAiB,EAAAD,CAAA,EAAA;AAAA,QAAA,OAAAJ,WAAA,CAAA,IAAA,EAAA;AAAA,UAAA,KAAA,EAEzBI,CAAA;AAAA,UAAA,OAAA,EAAAE,aAAA,CAAAR,eAAA,CAAA,EAAA,EAAA,EAAA,CAAAC,MAAA,CAEC7C,cAAe,CAAAb,KAAA,OAAA0D,MAAA,CAAS9D,MAAMC,IAAa,EAAA,MAAA,CAAA,EAAA,IAAA,CAC5CgC,EAAAA,aAAajC,KAAM,CAAAI,KAAA,EAAOJ,MAAMQ,MAAQ,EAAA4D,GAAA,CAAI,GAAGhE,KAAK,CAAA,CAAA;AAAA,SAAA,EAAA,CAGxDgE,GAAI,CAAA3B,GAAA,CAAI,UAAC6B,GAAA,EAAUC;yDAEZD,GACJ,EAAA;AAAA,YAAA,KAAA,EAAKC,CACL;YAAA,MAAMvE,EAAAA,MAAMW,IACZ;YAAA,SAASX,EAAAA,KAAM,CAAAY,WAAA;AAAA,YAAA,cAAA,EACDZ,KAAA,CAAMc,gBAAAA;AACtB,WAAA,CAAA,EAAA,IAAA,CAAA,CAAA;AAAA,SACD,CACH,CAAA,CAAA,CAAA;AAAA,OACD,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;KA9BN,CAAA;AAmCL,GAAA;AACF,CAAC,CAAA;;;;"}