{"version":3,"file":"ellipsis.js","sources":["../../src/table/ellipsis.tsx"],"sourcesContent":["/** 超出省略显示 */\nimport { defineComponent, PropType, ref, computed } from 'vue';\nimport debounce from 'lodash/debounce';\nimport { AttachNode, TNode } from '../common';\nimport { renderContent } from '../utils/render-tnode';\nimport { isNodeOverflow } from '../utils/dom';\nimport TTooltip, { TooltipProps } from '../tooltip';\n\nexport interface EllipsisProps {\n  content: string | TNode;\n  default: string | TNode;\n  tooltipContent: string | number | TNode;\n  placement: TooltipProps['placement'];\n  attach?: AttachNode;\n  tooltipProps: TooltipProps;\n  zIndex: number;\n}\n\nexport default defineComponent({\n  name: 'TEllipsis',\n\n  props: {\n    /** 内容 */\n    content: {\n      type: [String, Function] as PropType<EllipsisProps['content']>,\n    },\n    /** 内容，同 content */\n    default: {\n      type: [String, Function] as PropType<EllipsisProps['default']>,\n    },\n    /** 内容，同 content，可以单独自定义浮层内容，无需和触发元素保持一致 */\n    tooltipContent: {\n      type: [String, Number, Function] as PropType<EllipsisProps['tooltipContent']>,\n    },\n    /** 浮层位置 */\n    placement: String as PropType<EllipsisProps['placement']>,\n    /** 挂载元素 */\n    attach: [String, Function] as PropType<EllipsisProps['attach']>,\n    /** 透传 Tooltip 组件属性 */\n    tooltipProps: Object as PropType<EllipsisProps['tooltipProps']>,\n    zIndex: Number,\n    overlayClassName: String,\n    classPrefix: {\n      type: String,\n      default: 't',\n    },\n  },\n\n  setup(props) {\n    const root = ref();\n    const isOverflow = ref(false);\n\n    const ellipsisClasses = computed(() => [\n      `${props.classPrefix}-table__ellipsis`,\n      `${props.classPrefix}-text-ellipsis`,\n    ]);\n\n    const innerEllipsisClassName = computed<TooltipProps['overlayClassName']>(() => [\n      `${props.classPrefix}-table__ellipsis-content`,\n      props.overlayClassName,\n    ]);\n\n    // 当表格数据量大时，不希望默认渲染全量的 Tooltip，期望在用户 mouseenter 的时候再显示\n    const onTriggerMouseenter = () => {\n      if (!root.value) return;\n      isOverflow.value = isNodeOverflow(root.value);\n    };\n\n    const onTriggerMouseleave = () => {\n      if (!root.value) return;\n      isOverflow.value = isNodeOverflow(root.value);\n    };\n\n    // 使用 debounce 有两个原因：1. 避免 safari/firefox 等浏览器不显示省略浮层；2. 避免省略列快速滚动时，出现一堆的省略浮层\n    const onMouseAround = debounce((e: MouseEvent) => {\n      e.type === 'mouseleave' ? onTriggerMouseleave() : onTriggerMouseenter();\n    }, 80);\n\n    return {\n      root,\n      isOverflow,\n      ellipsisClasses,\n      innerEllipsisClassName,\n      onMouseAround,\n    };\n  },\n\n  render() {\n    const cellNode = renderContent(this, 'default', 'content');\n    const ellipsisContent = (\n      <div ref=\"root\" class={this.ellipsisClasses} onMouseenter={this.onMouseAround} onMouseleave={this.onMouseAround}>\n        {cellNode}\n      </div>\n    );\n    let content = null;\n    const tooltipProps = this.tooltipProps as EllipsisProps['tooltipProps'];\n    if (this.isOverflow) {\n      const rProps = {\n        content: (this.tooltipContent as string) || (() => cellNode),\n        destroyOnClose: true,\n        zIndex: this.zIndex,\n        attach: this.attach,\n        placement: this.placement,\n        overlayClassName: tooltipProps?.overlayClassName\n          ? this.innerEllipsisClassName.concat(tooltipProps.overlayClassName)\n          : this.innerEllipsisClassName,\n        ...tooltipProps,\n      };\n      content = <TTooltip {...rProps}>{ellipsisContent}</TTooltip>;\n    } else {\n      content = ellipsisContent;\n    }\n    return content;\n  },\n});\n"],"names":["_isSlot","s","Object","prototype","toString","call","_isVNode","defineComponent","name","props","content","type","String","Function","tooltipContent","Number","placement","attach","tooltipProps","zIndex","overlayClassName","classPrefix","setup","root","ref","isOverflow","ellipsisClasses","computed","concat","innerEllipsisClassName","onTriggerMouseenter","value","isNodeOverflow","onTriggerMouseleave","onMouseAround","debounce","e","render","cellNode","renderContent","ellipsisContent","_createVNode","rProps","_objectSpread","destroyOnClose","TTooltip","_default"],"mappings":"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"}