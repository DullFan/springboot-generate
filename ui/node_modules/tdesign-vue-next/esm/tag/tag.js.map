{"version":3,"file":"tag.js","sources":["../../src/tag/tag.tsx"],"sourcesContent":["import { computed, defineComponent, h, VNode } from 'vue';\nimport { CloseIcon as TdCloseIcon } from 'tdesign-icons-vue-next';\nimport tinycolor from 'tinycolor2';\n\nimport props from './props';\nimport { useConfig, usePrefixClass, useCommonClassName } from '../hooks/useConfig';\nimport { useGlobalIcon } from '../hooks/useGlobalIcon';\nimport { useTNodeJSX, useContent } from '../hooks/tnode';\nimport { Styles } from '../common';\nimport isString from 'lodash/isString';\n\nexport default defineComponent({\n  name: 'TTag',\n  props,\n  setup(props) {\n    const { globalConfig: tagGlobalConfig } = useConfig('tag');\n    const COMPONENT_NAME = usePrefixClass('tag');\n    const { CloseIcon } = useGlobalIcon({ CloseIcon: TdCloseIcon });\n    const renderTNodeJSX = useTNodeJSX();\n    const renderContent = useContent();\n    const { SIZE } = useCommonClassName();\n\n    const tagClass = computed(() => {\n      return [\n        `${COMPONENT_NAME.value}`,\n        `${COMPONENT_NAME.value}--${props.theme}`,\n        `${COMPONENT_NAME.value}--${props.variant}`,\n        {\n          [`${COMPONENT_NAME.value}--ellipsis`]: props.maxWidth,\n          [`${COMPONENT_NAME.value}--close`]: props.closable,\n          [`${COMPONENT_NAME.value}--disabled`]: props.disabled,\n          [SIZE.value[props.size]]: props.size !== 'medium',\n        },\n        props.shape !== 'square' && `${COMPONENT_NAME.value}--${props.shape}`,\n      ];\n    });\n\n    const tagStyle = computed<Styles>(() => {\n      const { maxWidth } = props;\n\n      const styles = getTagColorStyle();\n\n      return props.maxWidth\n        ? {\n            maxWidth: isNaN(Number(maxWidth)) ? String(maxWidth) : `${maxWidth}px`,\n            ...styles,\n          }\n        : styles;\n    });\n\n    const getTagColorStyle = () => {\n      const { color, variant } = props;\n      if (!color) return {};\n\n      const luminance = tinycolor(color).getLuminance();\n\n      const style: Styles = {\n        color: luminance > 0.5 ? 'black' : 'white',\n      };\n\n      if (variant === 'outline' || variant === 'light-outline') {\n        style.borderColor = color;\n      }\n      if (variant !== 'outline') {\n        const getLightestShade = () => {\n          const { r, g, b } = tinycolor(color).toRgb();\n          // alpha 0.1  is designed by @wen1kang\n          return `rgba(${r}, ${g}, ${b}, 0.1)`;\n        };\n        style.backgroundColor = variant === 'dark' ? color : getLightestShade();\n      }\n      if (variant !== 'dark') {\n        style.color = color;\n      }\n      return style;\n    };\n\n    const handleClick = (e: MouseEvent) => {\n      if (props.disabled) return;\n      props.onClick?.({ e });\n    };\n\n    const getCloseIcon = () => {\n      if (!props.closable) return null;\n      const iconClassName = `${COMPONENT_NAME.value}__icon-close`;\n      if (tagGlobalConfig.value.closeIcon) {\n        return h(tagGlobalConfig.value.closeIcon(h) as VNode, { class: iconClassName });\n      }\n      return (\n        <CloseIcon\n          onClick={({ e }: { e: MouseEvent }) => {\n            e.stopPropagation();\n            props.onClose?.({ e });\n          }}\n          class={iconClassName}\n        />\n      );\n    };\n\n    return () => {\n      // 关闭按钮 自定义组件使用 nativeOnClick 绑定事件\n      const closeIcon = getCloseIcon();\n      // 标签内容\n      const tagContent = renderContent('default', 'content');\n      // 图标\n      const icon = renderTNodeJSX('icon');\n\n      const title = isString(tagContent) ? tagContent : '';\n      const titleAttribute = title && props.maxWidth ? title : undefined;\n\n      return (\n        <div class={tagClass.value} style={tagStyle.value} onClick={handleClick}>\n          {icon}\n          {props.maxWidth ? (\n            <span class={{ [`${COMPONENT_NAME.value}--text`]: props.maxWidth }} title={titleAttribute}>\n              {tagContent}\n            </span>\n          ) : (\n            tagContent\n          )}\n          {!props.disabled && closeIcon}\n        </div>\n      );\n    };\n  },\n});\n"],"names":["defineComponent","name","props","setup","_useConfig","useConfig","tagGlobalConfig","globalConfig","COMPONENT_NAME","usePrefixClass","_useGlobalIcon","useGlobalIcon","CloseIcon","TdCloseIcon","renderTNodeJSX","useTNodeJSX","renderContent","useContent","_useCommonClassName","useCommonClassName","SIZE","tagClass","computed","concat","value","theme","variant","_defineProperty","maxWidth","closable","disabled","size","shape","tagStyle","styles","getTagColorStyle","_objectSpread","isNaN","Number","String","color","luminance","tinycolor","getLuminance","style","borderColor","getLightestShade","_tinycolor$toRgb","toRgb","r","g","b","backgroundColor","handleClick","e","_props2$onClick","onClick","getCloseIcon","iconClassName","closeIcon","h","_createVNode","_ref2","_props2$onClose","stopPropagation","onClose","tagContent","icon","title","isString","titleAttribute"],"mappings":"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"}