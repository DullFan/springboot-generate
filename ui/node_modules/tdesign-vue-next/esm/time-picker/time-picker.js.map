{"version":3,"file":"time-picker.js","sources":["../../src/time-picker/time-picker.tsx"],"sourcesContent":["import { computed, defineComponent, ref, toRefs, watch } from 'vue';\nimport dayjs from 'dayjs';\nimport customParseFormat from 'dayjs/plugin/customParseFormat';\nimport { TimeIcon as TdTimeIcon } from 'tdesign-icons-vue-next';\n\nimport TimePickerPanel from './panel/time-picker-panel';\nimport TSelectInput, { SelectInputBlurContext } from '../select-input';\nimport { formatInputValue, validateInputValue } from '../_common/js/time-picker/utils';\n\nimport type { InputProps } from '../input';\n\nimport props from './props';\n\n// hooks\nimport useVModel from '../hooks/useVModel';\nimport { useFormDisabled } from '../form/hooks';\nimport { useCommonClassName, useConfig, usePrefixClass } from '../hooks/useConfig';\nimport { useGlobalIcon } from '../hooks/useGlobalIcon';\n\ndayjs.extend(customParseFormat);\n\nexport default defineComponent({\n  name: 'TTimePicker',\n\n  props: { ...props },\n\n  setup(props) {\n    const { globalConfig } = useConfig('timePicker');\n    const COMPONENT_NAME = usePrefixClass('time-picker');\n    const { STATUS } = useCommonClassName();\n    const { TimeIcon } = useGlobalIcon({ TimeIcon: TdTimeIcon });\n\n    const currentValue = ref('');\n    const isShowPanel = ref(false);\n\n    const { value, modelValue } = toRefs(props);\n    const [innerValue, setInnerValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n\n    const disabled = useFormDisabled();\n    const { allowInput, format } = toRefs(props);\n\n    const inputClasses = computed(() => [\n      `${COMPONENT_NAME.value}__group`,\n      {\n        [STATUS.value.focused]: isShowPanel.value,\n      },\n    ]);\n\n    const handleShowPopup = (visible: boolean, context: { e: MouseEvent }) => {\n      isShowPanel.value = visible;\n      visible ? props.onOpen?.(context) : props.onClose?.(context); // trigger on-open and on-close\n    };\n\n    const handleClear = (context: { e: MouseEvent }) => {\n      const { e } = context;\n      e.stopPropagation();\n      currentValue.value = null;\n      setInnerValue(null);\n    };\n\n    const handleInputChange = (value: string) => {\n      currentValue.value = value;\n    };\n\n    const handleInputBlur = (value: string, context: SelectInputBlurContext) => {\n      if (allowInput.value) {\n        const isValidTime = validateInputValue(currentValue.value, format.value);\n        if (isValidTime) {\n          setInnerValue(formatInputValue(currentValue.value, format.value));\n        }\n      }\n      props.onBlur?.({ value, inputValue: context.inputValue, e: context.e });\n    };\n\n    const handleClickConfirm = () => {\n      const isValidTime = validateInputValue(currentValue.value, format.value);\n      if (isValidTime) setInnerValue(currentValue.value);\n      isShowPanel.value = false;\n    };\n\n    const handlePanelChange = (v: string, e: MouseEvent) => {\n      currentValue.value = v;\n      props.onPick?.(v, { e });\n    };\n\n    watch(\n      () => isShowPanel.value,\n      () => {\n        currentValue.value = isShowPanel.value ? innerValue.value ?? '' : '';\n      },\n    );\n\n    return () => (\n      <div class={COMPONENT_NAME.value}>\n        <TSelectInput\n          onFocus={props.onFocus}\n          onClear={handleClear}\n          disabled={disabled.value}\n          clearable={props.clearable}\n          allowInput={allowInput.value}\n          className={inputClasses.value}\n          suffixIcon={() => <TimeIcon />}\n          popupVisible={isShowPanel.value}\n          onInputChange={handleInputChange}\n          onBlur={handleInputBlur}\n          onPopupVisibleChange={handleShowPopup}\n          placeholder={!innerValue.value ? props.placeholder || globalConfig.value.placeholder : undefined}\n          value={isShowPanel.value ? currentValue.value : innerValue.value ?? undefined}\n          inputValue={isShowPanel.value ? currentValue.value : innerValue.value ?? undefined}\n          inputProps={{ ...(props.inputProps as InputProps), size: props.size }}\n          popupProps={{ overlayInnerStyle: { width: 'auto', padding: 0 }, ...(props.popupProps as object) }}\n          status={props.status}\n          tips={props.tips}\n          panel={() => (\n            <TimePickerPanel\n              steps={props.steps}\n              format={format.value}\n              value={currentValue.value}\n              isFooterDisplay={true}\n              isShowPanel={isShowPanel.value}\n              disableTime={props.disableTime}\n              onChange={handlePanelChange}\n              hideDisabledTime={props.hideDisabledTime}\n              handleConfirmClick={handleClickConfirm}\n              presets={props.presets}\n            />\n          )}\n        />\n      </div>\n    );\n  },\n});\n"],"names":["dayjs","extend","customParseFormat","defineComponent","name","props","_objectSpread","setup","_useConfig","useConfig","globalConfig","COMPONENT_NAME","usePrefixClass","_useCommonClassName","useCommonClassName","STATUS","_useGlobalIcon","useGlobalIcon","TimeIcon","TdTimeIcon","currentValue","ref","isShowPanel","_toRefs","toRefs","value","modelValue","_useVModel","useVModel","defaultValue","onChange","_useVModel2","_slicedToArray","innerValue","setInnerValue","disabled","useFormDisabled","_toRefs2","allowInput","format","inputClasses","computed","concat","_defineProperty","focused","handleShowPopup","visible","context","_props2$onOpen","_props2$onClose","onOpen","onClose","handleClear","e","stopPropagation","handleInputChange","handleInputBlur","_props2$onBlur","isValidTime","validateInputValue","formatInputValue","onBlur","inputValue","handleClickConfirm","handlePanelChange","v","_props2$onPick","onPick","watch","_innerValue$value","_innerValue$value2","_innerValue$value3","_createVNode","TSelectInput","onFocus","clearable","suffixIcon","placeholder","inputProps","size","overlayInnerStyle","width","padding","popupProps","status","tips","panel","TimePickerPanel","steps","disableTime","hideDisabledTime","presets"],"mappings":"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"}