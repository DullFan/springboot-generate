{"version":3,"file":"select-input.js","sources":["../../src/select-input/select-input.tsx"],"sourcesContent":["import { computed, defineComponent, onBeforeUnmount, onMounted, PropType, ref, SetupContext, toRefs, watch } from 'vue';\nimport Popup, { PopupInstanceFunctions, PopupProps, PopupVisibleChangeContext } from '../popup';\nimport props from './props';\nimport { TdSelectInputProps } from './type';\nimport useSingle, { SelectInputValueDisplayOptions } from './useSingle';\nimport useMultiple from './useMultiple';\nimport useOverlayInnerStyle from './useOverlayInnerStyle';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useTNodeJSX } from '../hooks';\n\nconst useComponentClassName = () => {\n  return {\n    NAME_CLASS: usePrefixClass('select-input'),\n    BASE_CLASS_BORDERLESS: usePrefixClass('select-input--borderless'),\n    BASE_CLASS_MULTIPLE: usePrefixClass('select-input--multiple'),\n    BASE_CLASS_POPUP_VISIBLE: usePrefixClass('select-input--popup-visible'),\n    BASE_CLASS_EMPTY: usePrefixClass('select-input--empty'),\n  };\n};\n\nexport default defineComponent({\n  name: 'TSelectInput',\n\n  props: {\n    ...props,\n    /**\n     * 非公开 API，请勿使用（后续即将删除）\n     * 自定义值呈现的选项\n     * useInputDisplay 表示在使用时仍然使用组件自带的输入回显实现，\n     * usePlaceholder 表示在使用时仍然使用自带的占位符实现\n     * */\n    valueDisplayOptions: {\n      type: Object as PropType<SelectInputValueDisplayOptions>,\n    },\n  },\n\n  setup(props: TdSelectInputProps & { valueDisplayOptions: SelectInputValueDisplayOptions }, context: SetupContext) {\n    const { NAME_CLASS, BASE_CLASS_BORDERLESS, BASE_CLASS_MULTIPLE, BASE_CLASS_POPUP_VISIBLE, BASE_CLASS_EMPTY } =\n      useComponentClassName();\n    const classPrefix = usePrefixClass();\n    const renderTNodeJSX = useTNodeJSX();\n\n    const selectInputRef = ref();\n    const popupRef = ref<PopupInstanceFunctions>();\n    const { multiple, value, popupVisible, borderless } = toRefs(props);\n\n    const { tOverlayInnerStyle, innerPopupVisible, onInnerPopupVisibleChange } = useOverlayInnerStyle(props);\n\n    const { isSingleFocus, commonInputProps, onInnerClear, renderSelectSingle } = useSingle(props, context, popupRef);\n\n    const { isMultipleFocus, tagInputRef, renderSelectMultiple } = useMultiple(props, context, popupRef);\n\n    const isFocus = computed(() => (props.multiple ? isMultipleFocus.value : isSingleFocus.value));\n\n    const classes = computed(() => [\n      `${NAME_CLASS.value}`,\n      {\n        [BASE_CLASS_MULTIPLE.value]: multiple.value,\n        [BASE_CLASS_BORDERLESS.value]: borderless.value,\n        [BASE_CLASS_POPUP_VISIBLE.value]: popupVisible.value ?? innerPopupVisible.value,\n        [BASE_CLASS_EMPTY.value]: value.value instanceof Array ? !value.value.length : !value.value,\n      },\n    ]);\n\n    const addKeyboardEventListener = (e: KeyboardEvent) => {\n      const code = e.code || e.key?.trim();\n      if (/(ArrowDown|ArrowUp)/.test(code) && !popupVisible.value) {\n        const ctx: PopupVisibleChangeContext = { ...context, trigger: 'trigger-element-focus' };\n        props.onPopupVisibleChange?.(true, ctx);\n      }\n    };\n\n    watch([isFocus], ([isFocus]) => {\n      if (popupVisible.value) return;\n      if (isFocus) {\n        selectInputRef.value.addEventListener('keydown', addKeyboardEventListener);\n      } else {\n        selectInputRef.value.removeEventListener('keydown', addKeyboardEventListener);\n      }\n    });\n\n    onMounted(() => {\n      if (!popupVisible.value && isFocus) {\n        selectInputRef.value.addEventListener('keydown', addKeyboardEventListener);\n      }\n    });\n\n    onBeforeUnmount(() => {\n      selectInputRef.value.removeEventListener('keydown', addKeyboardEventListener);\n    });\n\n    const onOverlayClick: PopupProps['onOverlayClick'] = (ctx) => {\n      ctx.e?.stopPropagation();\n      // do not set focus if target can be focused\n      if ((ctx.e.target as HTMLElement).tabIndex >= 0) return;\n      if (props.multiple) tagInputRef.value?.focus();\n    };\n\n    return {\n      classPrefix,\n      NAME_CLASS,\n      innerPopupVisible,\n      commonInputProps,\n      tOverlayInnerStyle,\n      selectInputRef,\n      popupRef,\n      classes,\n      onInnerClear,\n      renderTNodeJSX,\n      renderSelectSingle,\n      renderSelectMultiple,\n      onOverlayClick,\n      onInnerPopupVisibleChange,\n    };\n  },\n\n  render() {\n    // 浮层显示的受控与非受控\n    const visibleProps = { visible: this.popupVisible ?? this.innerPopupVisible };\n\n    const mainContent = (\n      <Popup\n        ref=\"popupRef\"\n        trigger={(this.popupProps as TdSelectInputProps['popupProps'])?.trigger || 'click'}\n        placement=\"bottom-left\"\n        {...visibleProps}\n        content={this.panel}\n        v-slots={{ ...this.$slots, content: this.$slots.panel }}\n        hideEmptyPopup={true}\n        {...{\n          onVisibleChange: this.onInnerPopupVisibleChange,\n          onOverlayClick: this.onOverlayClick,\n          ...(this.popupProps as TdSelectInputProps['popupProps']),\n          overlayInnerStyle: this.tOverlayInnerStyle,\n        }}\n      >\n        {this.multiple\n          ? this.renderSelectMultiple({\n              commonInputProps: this.commonInputProps,\n              onInnerClear: this.onInnerClear,\n              popupVisible: visibleProps.visible,\n              allowInput: this.allowInput,\n            })\n          : this.renderSelectSingle(visibleProps.visible)}\n      </Popup>\n    );\n\n    const tipsNode = this.renderTNodeJSX('tips');\n\n    const tipsClasses = [\n      `${this.classPrefix}-input__tips`,\n      `${this.classPrefix}-tips`,\n      `${this.classPrefix}-is-${this.status}`,\n    ];\n\n    return (\n      <div ref=\"selectInputRef\" class={this.classes}>\n        {mainContent}\n        {tipsNode && <div class={tipsClasses}>{tipsNode}</div>}\n      </div>\n    );\n  },\n});\n"],"names":["useComponentClassName","NAME_CLASS","usePrefixClass","BASE_CLASS_BORDERLESS","BASE_CLASS_MULTIPLE","BASE_CLASS_POPUP_VISIBLE","BASE_CLASS_EMPTY","defineComponent","name","props","_objectSpread","valueDisplayOptions","type","Object","setup","context","_useComponentClassNam","classPrefix","renderTNodeJSX","useTNodeJSX","selectInputRef","ref","popupRef","_toRefs","toRefs","multiple","value","popupVisible","borderless","_useOverlayInnerStyle","useOverlayInnerStyle","tOverlayInnerStyle","innerPopupVisible","onInnerPopupVisibleChange","_useSingle","useSingle","isSingleFocus","commonInputProps","onInnerClear","renderSelectSingle","_useMultiple","useMultiple","isMultipleFocus","tagInputRef","renderSelectMultiple","isFocus","computed","classes","_popupVisible$value","concat","_defineProperty","Array","length","addKeyboardEventListener","e","_e$key","code","key","trim","test","_props2$onPopupVisibl","ctx","trigger","onPopupVisibleChange","watch","_ref2","_ref3","_slicedToArray","addEventListener","removeEventListener","onMounted","onBeforeUnmount","onOverlayClick","_ctx$e","_tagInputRef$value","stopPropagation","target","tabIndex","focus","render","_this$popupVisible","_this$popupProps","_this","visibleProps","visible","mainContent","_createVNode","Popup","_mergeProps","popupProps","panel","onVisibleChange","overlayInnerStyle","_default","allowInput","$slots","content","tipsNode","tipsClasses","status"],"mappings":"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"}